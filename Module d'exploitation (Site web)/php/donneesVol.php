<?php
$code = $_COOKIE['code']; //récupére la valeur du cookie et le stock dans la variable $code
$placement = '../php/'.$code.'.txt';
$fichier = fopen($placement,'r'); //ouverture du fichier 

$premiere_lettre = substr($code, 0, 1); // prend la premiere lettre du nom du fichier

if($premiere_lettre == 'v'){ //verifie si la premeire lettre du nom du fichier égale à v, dans ce cas là on remplie la page avec les données récuperer à partir de la premeiere ligne du fichier texte 
    $premiere = fgets($fichier);
    fclose($fichier);


    if ($premiere !== false) {

        $elements = explode(".", $premiere); //sépare la premiere ligne 
        $page = file_get_contents("../html/principale.html"); // Lecture du contenu du fichier HTML 'principale.html'

        if($page !== false){ //remplace les balises dans le fichier html 
            $page = str_replace("EMV", "ON", $page);
            $page = str_replace("AD", $elements[2], $page);
            $page = str_replace("AA", $elements[3], $page);
            $page = str_replace("DH", $elements[0], $page);
            $page = str_replace("DM", $elements[1], $page);
            echo $page;
        }
        else {
        echo "Erreur lors de la lecture du fichier principale.html.";
        }

    } else {
        echo "Le fichier de données est vide.";
    }
}
else{
    $page = file_get_contents("../html/donnees.html");
    if($page !== false){
        $page = str_replace("EMV", 'OFF', $page);
        $page = str_replace("AD", 'none', $page);
        $page = str_replace("AA", 'none', $page);
        $page = str_replace("DH", 'none', $page);
        $page = str_replace("DM", 'none', $page);
        echo $page; 
    }
    else{
        echo "Erreur lors de la lecture fichier"; //Affiche une erreur si la lecture du fichier HTML a échoué
    }

}