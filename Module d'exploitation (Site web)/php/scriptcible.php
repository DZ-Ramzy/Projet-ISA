<html>
<body>
<?php
	if ($_SERVER["REQUEST_METHOD"] == "POST"){
        $chaine_valeurs = file_get_contents("php://input"); //recupere les donnees issues de la requete HTTP
        $data = json_decode($chaine_valeurs, true); //decrypte ces donnees pour les passer en objet JSON
        $donnees_tableau = explode(":",$data["fname2289A%@@oui"]); //recupere les donnees de la clef "fname2289A%@@oui", les valeurs correspondantes sont les donnees envoyees par l'application
        $nomFichier = $donnees_tableau[0] . ".txt"; //le nom du fichier est le code de connexion, le code est la premiere donnees dans les data JSON reçues
    	$i = 2;
    	$verif = file_get_contents($nomFichier); 
        if($verif==false && (substr($nomFichier,0,1)=="v")){ //permet de vérifier que le fichier n'existe pas deja et que le commence par v, si il commence par v l'experimentation a été faite en mode vol et il faut donc ecrire les donnees liees au vol sur la premiere ligne
        	$fichier = fopen($nomFichier, "a") or die("impossible d'ecrire dans le fichier");
        	fwrite($fichier, $donnees_tableau[1]); //ecriture des donnees du mode vol, elles suivent le code donc sont toujours en deuxième position
        	fwrite($fichier, "\n");
        	fclose($fichier);
 
        }
        else{
        	if(substr($nomFichier,0,1)!="v"){
        		$i = 1;
        	}
        }
        $fichier = fopen($nomFichier, "a") or die("impossible d'ecrire dans le fichier");
        for($e = $i;$e<count($donnees_tableau);$e+=1){ //ecriture du reste des donnees dans le fichier texte
			fwrite($fichier, $donnees_tableau[$e]);
			if($e<count($donnees_tableau)-1){
			      fwrite($fichier, "-");
			}			
		}
		fwrite($fichier, "\n");
		fclose($fichier);
        echo "reussi";
	}
?>
</body>
</html>